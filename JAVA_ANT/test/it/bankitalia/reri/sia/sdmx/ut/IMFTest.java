/* Copyright 2010,2014 Bank Of Italy
*
* Licensed under the EUPL, Version 1.1 or - as soon they
* will be approved by the European Commission - subsequent
* versions of the EUPL (the "Licence");
* You may not use this work except in compliance with the
* Licence.
* You may obtain a copy of the Licence at:
*
*
* http://ec.europa.eu/idabc/eupl
*
* Unless required by applicable law or agreed to in
* writing, software distributed under the Licence is
* distributed on an "AS IS" basis,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
* express or implied.
* See the Licence for the specific language governing
* permissions and limitations under the Licence.
*/
package it.bankitalia.reri.sia.sdmx.ut;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;
import it.bankitalia.reri.sia.sdmx.api.DSDIdentifier;
import it.bankitalia.reri.sia.sdmx.api.Dimension;
import it.bankitalia.reri.sia.sdmx.api.PortableTimeSeries;
import it.bankitalia.reri.sia.sdmx.client.SdmxClientHandler;
import it.bankitalia.reri.sia.sdmx.client.custom.IMF;
import it.bankitalia.reri.sia.util.SdmxException;

import java.util.List;
import java.util.Map;

import org.junit.BeforeClass;
import org.junit.Test;

public class IMFTest {
	@BeforeClass
	public static void setUp() throws Exception {
	}

	@Test
	public void testGetDSDIdentifier() throws SdmxException {
		DSDIdentifier keyF = SdmxClientHandler.getDSDIdentifier(IMF.class.getSimpleName(), "PGI");
		assertNotNull("Null key family for PGI", keyF);
		assertEquals("Wrong Key Family", "PGI", keyF.getId());
	}

	@Test
	public void testGetFlows() throws SdmxException {
		Map<String, String> f = SdmxClientHandler.getFlows(IMF.class.getSimpleName(), "PGI");
		assertNotNull("Null getFlows result", f);
		String descr = f.get("PGI");
		assertEquals("Wrong description for PGI", "IMF,PGI ; Principal Global Indicators", descr);
	}

	@Test
	public void testGetDimensions() throws SdmxException {
		List<Dimension> dim = SdmxClientHandler.getDimensions(IMF.class.getSimpleName(), "PGI");
		assertNotNull("Null getDimensions result PGI", dim);
		String result = "[Dimension [id=REF_AREA, position=1, codelist=Codelist [id=IMF/CL_AREA, codes={IT=Italy, A1=World, FR=France, RU=Russian Federation, COU=Country, CN=China, P.R.: Mainland, US=United States, IN=India, ZA=South Africa, CH=Switzerland, AU=Australia, MX=Mexico, AR=Argentina, ID=Indonesia, CA=Canada, JP=Japan, DE=Germany, I6=Euro Area, ES=Spain, BR=Brazil, SG=Singapore, GB=United Kingdom, KR=Korea, Republic of, TR=Turkey, SA=Saudi Arabia, HK=China, P.R.: Hong Kong, NL=Netherlands}]], Dimension [id=PGI_CONCEPT, position=2, codelist=Codelist [id=IMF/CL_PGI_CONCEPT, codes={GCE_G01_DUB2_AC=Consolidated Central Government, Expense (accrual basis), GBECE_G01_CA=Budgetary Central Government, Payments for operating activities, Compensation of Employees (cash basis), GCR_G01_AC=Consolidated Central Government, Revenue (accrual basis), GCXMTE_G01_CA=Consolidated Central Government, Total Expenditure (cash basis), PGICP=Consumer Prices, FITB=Treasury Bill Rate, FASMBC=Central Bank, Monetary Base Liabilities in the form of Currency in Circulation, NGDP=Gross Domestic Product (Nominal), FFSLOO=Other Financial Corporations Liabilities to Residents Other than the Central Bank, Other Depository Corporations, Other Financial Corporations, and General Government, WLDIND=World Energy Prices, FASAOR=Central Bank Claims on Residents Other than General Government and Other Depository Corporations, FOSE=Other Depository Corporations Shares and other Equity Liabilities, PGIOS=Other Sectors, GCADAN_G01_AC=Consolidated Central Government, Net Acquisition of Nonfinancial Assets (accrual basis), GCEI_G01_AC=Consolidated Central Government Expense, Interest (accrual basis), PGIT=Trade, GCXCBN_G01_AC=Consolidated Central Government, Net Operating Balance (accrual basis), FIST=Short-term Policy Rate, PGICB=Central Bank, GG=General Government, Consolidated (accrual basis), PGICA=Current Account, FISR=Savings Rate, GB=Central Government, Budgetary (cash basis), FASAOF=Central Bank Claims on Other Financial Corporations, FIGB=Government Bond Yield, FOFL=Other Financial Corporations Total Liabilities , FASAOC=Central Bank Claims on Residents Other than General Government, Other Depository Corporations, and Other Financial Corporations, PGII=Interest Rates, FOSAOR=Other Depository Corporations Claims on Residents Other than the Central Bank, Other Depository Corporations, and General Government, NFI_R=GDP (Volume) Gross Fixed Capital Formation, GCECE_G01_CA=Consolidated Central Government, Payments for operating activities, Compensation of Employees (cash basis), PGIIIP=International Investment Position, FOSAOO=Other Depository Corporations Claims on Residents Other than the Central Bank, Other Depository Corporations, Other Financial Corporations, and General Government, FOFA=Other Financial Corporations Total Assets, FOSOAL=Other Depository Corporations Liabilities to Other Depository Corporations, BIP_BP6=Balance on Income, GBXCCO_G01_CA=Budgetary Central Government, Net Inflow from operating activities (cash basis), FOSAOF=Other Depository Corporations Claims on Other Financial Corporations, GGR_G01_CA=Revenue, FOSOAA=Other Depository Corporations Claims on Other Depository Corporations, GGALCU_G01_AC=Maastricht Debt, NGDP_R=Gross Domestic Product (Volume), FASGG=Central Bank Claims on General Government, GCALW_G01_AC=Consolidated Central Government, Net Financial Worth (accrual basis), GBECE_G01_AC=Budgetary Central Government, Expense, Compensation of Employees (accrual basis), FOSLGG=Other Depository Corporations Liabilities to General Government, FASE=Central Bank Shares and Other Equity Liabilities, GGXCCB_G01_CA=Cash surplus/deficit, GCXMTE_G01_AC=Consolidated Central Government, Total Expenditure (accrual basis), LOCNSH=Share Prices, FOSGG=Other Depository Corporations Claims on General Government, NGDP_D=Gross Domestic Product Deflator, NX_R=GDP (Volume) Exports of Goods and Services, NINV=GDP (Nominal) Change in Inventories, LUR=Unemployment Rate, DB_S=Short-Term External Debt, Deposit-Takers, FASOXB=Central Bank Unclassified Items (Net Liabilities), FFSGG=Other Financial Corporations Claims on General Government, FODL=Other Depository Corporations Total Liabilities, DB_L=Long-Term External Debt, Deposit-Takers, PGIODCLT=Liabilities to:, GBXCCB_G01_CA=Budgetary Central Government, Cash Surplus/Deficit (cash basis), GCECE_G01_AC=Consolidated Central Government, Expense, Compensation of Employees (accrual basis), GBALN_G01_CA=Budgetary Central Government, Debt at Nominal Value (cash basis), GGEI_G01_CA=Interest, BIT=Current Account Balance of Current Transfers, FID=Interest Rates, Discount Rate, FODA=Other Depository Corporations Total Assets, FFSORO=Other Financial Corporations Claims on Residents Other than Central Bank, Other Depository Corporations, Other Financial Corporations, and General Government, BIS_BP6=Balance on Secondary Income, FIDR=Deposit Rate, FOSOXB=Other Depository Corporations Unclassified Items (Net Liabilities), DO=Total External Debt, Other Sectors, GBALFV_G01_CA=Budgetary Central Government, Debt at Face Value (cash basis), GGR_G01_AC=Consolidated General Government, Revenue (accrual basis), FDSAD=Domestic Credit (Consolidated balance sheet of the banking sector), DI=External Debt, Direct Investment's Intercompany Lending, FOSAMB=Int'l Banking Statistics (BIS) Claims on BIS Reporting Banks, PGILM=Labor Market, PZPIOIL=Commodity Prices, Crude Oil (Petroleum), DG=Total External Debt, General Government, GBXCOP_G01_CA=Budgetary Central Government, Net Inflow from operating activities, Primary Net Inflow from operating activities (cash basis), PGILI=Leading Indicators, DB=Total External Debt, Deposit-Takers, TXG_R=Trade, Exports of Goods, Volume, GBRT_G01_CA=Budgetary Central Government, Receipts from operating activities, Taxes (cash basis), AIPMA=Manufacturing Production Index, EREER=Real Effective Exchange Rate, GGECE_G01_CA=Compensation of Employees, GCXCNL_G01_AC=Consolidated Central Government, Net Lending/Borrowing (accrual basis), GG_CA=General Government, Consolidated (cash basis), GGXOBP_G01_AC=Consolidated General Government, Primary Operating Balance (accrual basis), GGEI_G01_AC=Consolidated General Government, Expense, Interest (accrual basis), NFI=GDP (Nominal) Gross Fixed Capital Formation, BGS=Current Account Balance of Goods and Services, NFG=GDP (Nominal) Acquisitions less Disposals of Valuables, PGICOOFC=Claims on:, GCRT_G01_CA=Consolidated Central Government, Receipts from operating activities, Taxes (cash basis), GBE_G01_DUB2_CA=Budgetary Central Government, Payments for operating activities (cash basis), 017=Demographic Indicators, 015=Exchange Rates, NX=GDP (Nominal) Exports of Goods and Services, FASLOO=Central Bank Other Liabilities to Residents Other than General Government, Other Depository Corporations, and Other Financial Corporations, GGALFV_G01_AC=Consolidated General Government, Debt at Face Value (accrual basis), 010=Financial Indicators, NCG_R=GDP (Volume) Government Consumption Expenditure, D_S=Short-term External Debt, BSCICP03=Business Confidence Indicator, GB_AC=Central Government, Budgetary (accrual basis), FASLOF=Central Bank Other Liabilities to Other Financial Corporations, NM=GDP (Nominal) Imports of Goods and Services, FFSOCL=Other Financial Corporations Liabilities to Other Financial Corporations, GBADAN_G01_CA=Budgetary Central Government, Net Outflow from Investments in Nonfinancial Asset (cash basis), GGALM_G01_AC=Consolidated General Government, Debt at Market Value (accrual basis), FOSLOO=Other Depository Corporations Liabilities to Residents Other than Central Bank, Other Depository Corporations, Other Financial Corporations, and General Government, GBRT_G01_AC=Budgetary Central Government, Revenue, Taxes (accrual basis), DMA_S=Short-Term External Debt, Central Bank, GCALN_G01_AC=Consolidated Central Government, Debt at Nominal Value (accrual basis), ENEER=Nominal Effective Exchange Rate, GGALW_G01_AC=Consolidated General Government, Net Financial Worth (accrual basis), FFSOCA=Other Financial Corporations Claims on Other Financial Corporations, GBR_G01_CA=Budgetary Central Government, Receipts from operating activities (cash basis), 008=Market Indicators, DMA_L=Long-Term External Debt, Central Bank, GCXCCO_G01_CA=Consolidated Central Government, Net Inflow from operating activities (cash basis), 007=Government and Public Sector Finance, FOSLOF=Other Depository Corporations Liabilities to Other Financial Corporations, GC_CA=Central Government, Consolidated (cash basis), 005=External Indicators, FASMBLO=Central Bank,  Monetary Base Liabilities to Other Residents, GGECE_G01_AC=Consolidated General Government, Compensation of Employees (accrual basis), 003=National Accounts, NSDGDP=GDP (Nominal) Statistical Discrepancy, ENDE=Exchange Rates, National Currency per U.S. Dollar, End of Period, PCPI=Consumer Prices, CPI, All Items, FASMBLG=Central Bank Other Liabilities to General Government, FFSOR=Other Financial Corporations Claims on Residents Other than Central Bank, Other Depository Corporations, and General Government, ENDA=Exchange Rates, National Currency per U.S. Dollar, Period Average, FASMBLD=Central Bank, Monetary Base Liabilities to Other Depository Corporations, FIMM=Money Market Rate, GGE_G01_DUB2_CA=Expense, PGICOCB=Claims on:, PGICOODC=Claims on:, GCRT_G01_AC=Consolidated Central Government, Revenue, Taxes (accrual basis), GBE_G01_DUB2_AC=Budgetary Central Government, Expense (accrual basis), DO_S=Short-Term External Debt, Other Sectors, LOCNSH_EOP=Share Prices, End of Period, GBXMTE_G01_CA=Budgetary Central Government, Total expenditure (cash basis), DO_L=Long-Term External Debt, Other Sectors, FFSE=Other Financial Corporations Shares and Other Equity Liabilities, GGXMTE_G01_CA=Total expenditure, Cash, GGALN_G01_CA=Debt (at Nominal Value), FILR=Lending Rate, LP=Population, FASAF=Central Bank Claims on Nonresidents, FASAD=Central Bank Claims on Other Depository Corporations, NCP=GDP (Nominal) Household Consumption Expenditure, including NPISH, GCXCCB_G01_CA=Consolidated Central Government, Cash Surplus Deficit (cash basis), GBXCBN_G01_AC=Budgetary Central Government, Net Operating Balance (accrual basis), PGIIBS=Int'l Banking Statistics, GGADAN_G01_AC=Consolidated General Government, Net Acquisition of Nonfinancial Assets (accrual basis), GGXCBN_G01_AC=Consolidated General Government, Net Operating Balance (accrual basis), FFSAOD=Other Financial Corporations Claims on Other Depository Corporations, FOSAF=Other Depository Corporations Claims on Nonresidents, NCG=GDP (Nominal) Government Consumption Expenditure, DG_S=Short-Term External Debt, General Government, PGIOFCLT=Liabilities to:, FASMB=Central Bank Liabilities, Monetary Base, GBR_G01_AC=Budgetary Central Government, Revenue (accrual basis), FOSAB=Int'l Banking Statistics (BIS) Banks' Claims on Non-Residents, FOSAA=Other Depository Corporations Claims on Central Bank, GC_AC=Central Government, Consolidated (accrual basis), GCALFV_G01_CA=Consolidated Central Government, Debt at Face Value (cash basis), DG_L=Long-Term External Debt, General Government, FOSLMB=Int'l Banking Statistics (BIS) Liabilities to BIS Reporting Banks, SLRTTO01=Total Retail Trade, FFSLGG=Other Financial Corporations Liabilities to General Government, GCXCOP_G01_CA=Consolidated Central Government, Net Inflow from operating activities, Primary Net Inflow from operating activities (cash basis), IL_BP6=Liabilities, PGIGG=General Government, FFSAF=Other Financial Corporations Claims on Nonresidents, FASLO=Central Bank Other Liabilities to Other Residents, FFSAD=Other Financial Corporations Claims on Depository Corporations, FFSAC=Other Financial Corporations Claims on Central Bank, PGICBL=Central Bank Liabilities, GGE_G01_DUB2_AC=Consolidated General Government, Expense (accrual basis), PGIOFCL=Other Financial Corporations: Liabilities, FASLF=Central Bank Other Liabilities to Nonresidents, CSCICP03=Consumer Confidence Indicator, PGIODCL=Other Depository Corporations: Liabilities, FASLD=Central Bank Other Liabilities to Other Depository Corporations, BGS_BP6=Balance of Goods and Services, FOSLO=Other Depository Corporations Liabilities to Residents Other than Central Bank, Other Depository Corporations, and General Government, PGICBA=Central Bank Assets, PGIOFCA=Other Financial Corporations: Assets, GBXMTE_G01_AC=Budgetary Central Government, Total expenditure (accrual basis), I_BP6=Net, AIP=Industrial Production Index, PGIODCA=Other Depository Corporations: Assets, FOSLF=Other Depository Corporations Liabilities to Nonresidents, GGXMTE_G01_AC=Consolidated General Government, Total expenditure (accrual basis), GGALN_G01_AC=Debt (at Nominal Value), BIXT=Current Account Balance on Income, NM_R=GDP (Volume) Imports of Goods and Services, PGIOLT=Other Liabilities to:, FOSLB=Int'l Banking Statistics (BIS) Banks' Liabilities to Non-Residents, FOSLA=Other Depository Corporations Liabilities to Central Bank, BCA=Current Account Balance, BCA_BP6=Balance, I=International Investment Position, Net, GGRT_G01_CA=Taxes, GBEI_G01_CA=Budgetary Central Government, Payments for operating activities, Interest (cash basis), TMG=Trade, Imports of Goods, c.i.f., FFSLO=Other Financial Corporations Liabilities to Residents Other than the Central Bank, Other Depository Corporations, and General Government, GCXOBP_G01_AC=Consolidated Central Government, Net Operating Balance, Primary Operating Balance (accrual basis), D=Total External Debt, IA_BP6=Assets, FFSOXB=Other Financial Corporations  Unclassified Items (Net Liabilities), FFSLF=Other Financial Corporations Liabilities to Nonresidents, RAFA=Reserves and Short-Term International Liquidity, Total Reserve Assets, FFSLD=Other Financial Corporations Liabilities to Other Depository Corporations, FFSLC=Other Financial Corporations Liabilities to Central Bank, PGIRA=Reserves and Short-Term International Liquidity, FMBND=National Definition of Broad Money, GCE_G01_DUB2_CA=Consolidated Central Government, Payments for operating activities (cash basis), PCPIHE=Consumer Prices, CPI, Electricity, Gas and Other Fuels, GCR_G01_CA=Consolidated Central Government, Receipts from operating activities (cash basis), PCPIHA=Consumer Prices, CPI, Harmonized, NCP_R=GDP (Volume) Household Consumption Expenditure, including NPISH, IL=International Investment Position, Liabilities, PGIED=External Debt, FAL=Central Bank Total Liabilities, GCADAN_G01_CA=Consolidated Central Government, Net Outflow from Investments in Nonfinancial Asset (cash basis), GCEI_G01_CA=Consolidated Central Government, Payments for operating activities, Interest (cash basis), RAOFA=Reserves and Short-Term International Liquidity, Other Foreign Currency Assets, GCE_G01_CA=Consolidated Central Government, Payments for operating activities (cash basis), GGXCNL_G01_AC=Consolidated General Government, Net Lending/Borrowing (accrual basis), IA=International Investment Position, Assets, TXG=Trade, Exports of Goods, f.o.b., FAA=Central Bank Total Assets, SPASTT01=Share Prices, All Shares, Broad, Total, PGIDT=Deposit-Takers, PPPI=Producer Prices, TMG_R=Trade, Imports of Goods, Volume, FODNFS=Other Depository Corporations Credit to Non-Financial Sector, RAPDNT=Reserves and Short-Term International Liquidity, Short-Term Predetermined Net Drains, GGRT_G01_AC=Consolidated General Government, Revenue, Taxes (accrual basis), GBEI_G01_AC=Budgetary Central Government, Expense, Interest (accrual basis), DMA=Total External Debt, Central Bank, GBXCNL_G01_AC=Budgetary Central Government, Net Lending/Borrowing (accrual basis)}]], Dimension [id=DATASOURCE, position=3, codelist=Codelist [id=IMF/CL_PGI_DATASOURCE, codes={BOP=Balance of Payments Statistics (BOP), SDDSGDDS=Quarterly External Debt Statistics (QEDS), QEDS=Special Data Dissemination Standard (SDDS), Quarterly External Debt Statistics, IFS=International Financial Statistics (IFS), BIS=Bank for International Settlements (BIS), MEI=OECD Main Economic Indicators, IRFC=International Reserves Template}]], Dimension [id=UNITOFMEASURE, position=4, codelist=Codelist [id=IMF/CL_PGI_UNITOFMEASURE, codes={E_R_B=Euros, Billions, Reported, N_TR=National Currency, Trillions, N_B=National Currency, Billions, E_B=Euros, Billions, PSA=Growth rate to previous period, Seasonally Adjusted, NSA_M=National Currency, Seasonally Adjusted, Millions, USBR=US Dollars per Barrel, L_D_M=US Dollars, Millions, Derived, NSA_B=National Currency, Seasonally Adjusted, Billions, NUSD=National Currency per US Dollar, AASA=Amplitude Adjusted, Seasonally Adjusted, F=Percent, IND2005SA=Index, 2005=100, Seasonally Adjusted, PCOPP=Percent Change over Previous Period, L_T=US Dollars, Thousands, PGDP=Percent of GDP, PRATE=Percentage Rate, PCOPPSA=Percent Change over Previous Period, Seasonally Adjusted, PER_M=Number of Persons, Millions, PCOCYSA=Percent Change over Corresponding Period of Previous Year, Seasonally Adjusted, PAN=Percent per Annum, L_M=US Dollars, Millions, USSA_B=US Dollars, Seasonally Adjusted, Billions, E_R_M=Euros, Millions, Reported, DN100SA=Index Number, Normal = 100, Seasonally Adjusted, ESA_B=Euros, Seasonally Adjusted, Billions, N_M=National Currency, Millions, E_M=Euros, Millions, IND2005=Index, 2005=100, PCOCY=Percent Change over Corresponding Period of Previous Year, L_B=US Dollars, Billions}]], Dimension [id=FREQ, position=5, codelist=Codelist [id=IMF/CL_FREQ, codes={A=Annual, Q=Quarterly, M=Monthly}]]]";
		assertEquals("Wrong dimensions for PGI", result, dim.toString());
	}
	
	@Test
	public void testGetCodes() throws SdmxException {
			Map<String, String> codes = SdmxClientHandler.getCodes(IMF.class.getSimpleName(), "PGI", "FREQ");
			assertNotNull("Null getCodes result", codes);
			assertEquals("Wrong code for FREQ annual", codes.get("A"), "Annual");
	}

	@Test
	public void testGetTimeSeriesFromID() throws SdmxException {
		List<PortableTimeSeries> res = SdmxClientHandler.getTimeSeries(IMF.class.getSimpleName(), "PGI.US+JP+CN+GB+CA+FR.PCPI.IFS.PCOCY.A", "1980", "2010");
		assertNotNull("Null time series result", res);
		//warning: they depend on eventual order
		String annual = res.get(0).getName();
		assertEquals("Wrong name for first time series", "PGI.US.IFS.PCPI.A.PCOCY", annual);
		String start = res.get(0).getTimeSlots().get(0);
		assertEquals("Wrong start date for time series", "1980", start);
		//System.out.println(res);
	}

}
